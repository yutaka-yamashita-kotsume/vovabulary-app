<div class="max-w-2xl mx-auto px-4 py-12 text-center">
  
  <div class="mb-6">
    <span class="px-4 py-2 bg-slate-100 text-slate-600 rounded-full text-sm font-bold">
      Question <%= @current_index %> / <%= @total_questions %>
    </span>
  </div>

  <div class="bg-white rounded-3xl p-10 shadow-xl border border-slate-100 mb-8">
    <p class="text-sm text-indigo-500 font-bold tracking-widest uppercase mb-2">ã“ã®å˜èªã®æ„å‘³ã¯ï¼Ÿ</p>
    
    <%# å˜èªè¡¨ç¤ºéƒ¨åˆ† %>
    <h2 id="question-text" class="text-5xl font-extrabold text-slate-800 mb-10">
      <%= @correct_word.original_text %>
    </h2>
<div class="flex justify-center gap-1 mb-6">
  <span class="text-xs text-slate-400 mr-2">Current Status:</span>
  <% @correct_word.consecutive_correct_count.times do %>
    <span class="text-xl">ğŸ”¥</span>
  <% end %>
  <% (3 - @correct_word.consecutive_correct_count).times do %>
    <span class="text-xl text-slate-200">â—‹</span>
  <% end %>
</div>

    <div class="grid grid-cols-1 gap-4">
      <% @choices.each do |choice| %>
        <button onclick="checkAnswer(this, '<%= choice == @correct_word %>')" 
                class="choice-btn w-full py-4 px-6 text-lg font-semibold rounded-2xl border-2 border-slate-100 hover:border-indigo-500 hover:bg-indigo-50 transition-all duration-200 text-slate-700">
          <%= choice.meaning %>
        </button>
      <% end %>
    </div>
  </div>

  <%= link_to "ä¸€è¦§ã«æˆ»ã‚‹", root_path, class: "text-slate-400 text-sm" %>
</div>

<script>
  // â‘  éŸ³å£°èª­ã¿ä¸Šã’ï¼ˆã‚ˆã‚Šå®‰å®šã—ãŸæ›¸ãæ–¹ï¼‰
  function speak(text) {
    if (!text) return;
    window.speechSynthesis.cancel(); // å‰ã®éŸ³å£°ã‚’æ­¢ã‚ã‚‹
    const uttr = new SpeechSynthesisUtterance(text);
    uttr.lang = 'en-US';
    uttr.rate = 0.9;
    window.speechSynthesis.speak(uttr);
  }

  // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
  document.addEventListener("turbo:load", function() {
    const questionText = document.getElementById("question-text");
    if (questionText) {
      setTimeout(() => {
        speak(questionText.innerText.trim());
      }, 600);
    }
  });

  // â‘¡ å›ç­”ãƒã‚§ãƒƒã‚¯é–¢æ•°ï¼ˆæ–‡æ³•ã‚¨ãƒ©ãƒ¼ã‚’ä¿®æ­£æ¸ˆï¼‰
  async function checkAnswer(button, isCorrectStr) {
    const isCorrect = (isCorrectStr === "true");
    const buttons = document.querySelectorAll('.choice-btn');
    
    // å…¨ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
    buttons.forEach(btn => btn.disabled = true);

    // ã‚µãƒ¼ãƒãƒ¼ã«çµæœã‚’é€ä¿¡
    try {
      const response = await fetch("/quiz/record_answer", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Accept": "application/json",
          "X-CSRF-Token": document.querySelector('meta[name="csrf-token"]').content
        },
        body: JSON.stringify({
          word_id: "<%= @correct_word.id %>",
          correct: isCorrect
        })
      });
      console.log("Record status:", response.status);
    } catch (e) {
      console.error("Fetch error:", e);
    } // â† ã“ã“ã§ try ã‚’ã—ã£ã‹ã‚Šé–‰ã˜ã¾ã—ãŸ

    // è¦‹ãŸç›®ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
    if (isCorrect) {
      button.style.backgroundColor = "#22c55e";
      button.style.color = "white";
      button.innerHTML += " âœ¨ Correct!";
    } else {
      button.style.backgroundColor = "#ef4444";
      button.style.color = "white";
      button.innerHTML += " âŒ Wrong...";
    }
    
    // 1.2ç§’å¾Œã«æ¬¡ã®å•é¡Œã¸
    setTimeout(() => {
      // TurboãŒæ­»ã‚“ã§ã„ã¦ã‚‚å‹•ãã‚ˆã†ã« location.href ã‚’å„ªå…ˆ
      window.location.href = "<%= quiz_path %>";
    }, 1200);
  }
</script>