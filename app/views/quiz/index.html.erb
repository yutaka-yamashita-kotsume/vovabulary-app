<div class="max-w-2xl mx-auto px-4 py-12 text-center">
  
  <div class="mb-6">
    <span class="px-4 py-2 bg-slate-100 text-slate-600 rounded-full text-sm font-bold">
      Question <%= @current_index %> / <%= @total_questions %>
    </span>
  </div>

  <div class="bg-white rounded-3xl p-10 shadow-xl border border-slate-100 mb-8">
    <p class="text-sm text-indigo-500 font-bold tracking-widest uppercase mb-2">ã“ã®å˜èªã®æ„å‘³ã¯ï¼Ÿ</p>
    
    <%# å˜èªè¡¨ç¤ºéƒ¨åˆ† %>
    <h2 id="question-text" class="text-5xl font-extrabold text-slate-800 mb-10">
      <%= @correct_word.original_text %>
    </h2>
<div class="flex justify-center gap-1 mb-6">
  <span class="text-xs text-slate-400 mr-2">Current Status:</span>
  <% @correct_word.consecutive_correct_count.times do %>
    <span class="text-xl">ğŸ”¥</span>
  <% end %>
  <% (3 - @correct_word.consecutive_correct_count).times do %>
    <span class="text-xl text-slate-200">â—‹</span>
  <% end %>
</div>

    <div class="grid grid-cols-1 gap-4">
      <% @choices.each do |choice| %>
        <button onclick="checkAnswer(this, '<%= choice == @correct_word %>')" 
                class="choice-btn w-full py-4 px-6 text-lg font-semibold rounded-2xl border-2 border-slate-100 hover:border-indigo-500 hover:bg-indigo-50 transition-all duration-200 text-slate-700">
          <%= choice.meaning %>
        </button>
      <% end %>
    </div>
  </div>

  <%= link_to "ä¸€è¦§ã«æˆ»ã‚‹", root_path, class: "text-slate-400 text-sm" %>
</div>

<script>
  // â‘  éŸ³å£°èª­ã¿ä¸Šã’é–¢æ•°
  function speak(text) {
    window.speechSynthesis.cancel();
    const uttr = new SpeechSynthesisUtterance();
    uttr.text = text;
    uttr.lang = 'en-US';
    uttr.rate = 0.9;
    window.speechSynthesis.speak(uttr);
  }

  // ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‚‰è‡ªå‹•çš„ã«éŸ³å£°ã‚’å†ç”Ÿ
  document.addEventListener("turbo:load", function() {
    const questionText = document.getElementById("question-text");
    if (questionText) {
      // ç”»é¢è¡¨ç¤ºã‹ã‚‰å°‘ã—ã ã‘é…ã‚‰ã›ã¦å†ç”Ÿï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã®è‡ªå‹•å†ç”Ÿãƒ–ãƒ­ãƒƒã‚¯å¯¾ç­–ï¼‰
      setTimeout(() => {
        speak(questionText.innerText.trim());
      }, 500);
    }
  }, { once: true });

  // â‘¡ å›ç­”ãƒã‚§ãƒƒã‚¯ã¨è‡ªå‹•é·ç§»
  function checkAnswer(button, isCorrect) {
    const buttons = document.querySelectorAll('.choice-btn');
    buttons.forEach(btn => btn.disabled = true);

    if (isCorrect === "true") {
      button.classList.add('bg-green-500', 'text-white', 'border-green-500');
      button.innerHTML += " âœ¨ Correct!";
    } else {
      button.classList.add('bg-red-500', 'text-white', 'border-red-500');
      button.innerHTML += " âŒ Wrong...";
      // ä¸æ­£è§£ã®ã¨ãã¯æ­£è§£ã®ãƒœã‚¿ãƒ³ã‚‚ãƒã‚¤ãƒ©ã‚¤ãƒˆã™ã‚‹ã¨è¦ªåˆ‡ã§ã™
    }
    
    // 1.5ç§’å¾Œã«è‡ªå‹•ã§æ¬¡ã®å•é¡Œã¸
    setTimeout(() => {
      window.location.href = "<%= quiz_path %>";
    }, 1000);
  }

  async function checkAnswer(button, isCorrect) {
    const buttons = document.querySelectorAll('.choice-btn');
    buttons.forEach(btn => btn.disabled = true);

    // â˜…ã‚µãƒ¼ãƒãƒ¼ã«çµæœã‚’é€ä¿¡
    await fetch("/quiz/record_answer", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-CSRF-Token": document.querySelector('meta[name="csrf-token"]').content
      },
      body: JSON.stringify({
        word_id: "<%= @correct_word.id %>",
        correct: isCorrect
      })
    });

    if (isCorrect === "true") {
      button.style.backgroundColor = "#22c55e";
      button.style.color = "white";
      button.innerHTML += " âœ¨ Correct!";
    } else {
      button.style.backgroundColor = "#ef4444";
      button.style.color = "white";
      button.innerHTML += " âŒ Wrong...";
    }
    
    setTimeout(() => {
      Turbo.visit("<%= quiz_path %>", { action: "replace" });
    }, 1200);
  }
</script>