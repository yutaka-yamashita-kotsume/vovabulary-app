<div class="max-w-2xl mx-auto px-4 py-12 text-center">
  
  <div class="mb-6">
    <span class="px-4 py-2 bg-slate-100 text-slate-600 rounded-full text-sm font-bold">
      Question <%= @current_index %> / <%= @total_questions %>
    </span>
  </div>

  <div class="bg-white rounded-3xl p-10 shadow-xl border border-slate-100 mb-8">
    <p class="text-sm text-indigo-500 font-bold tracking-widest uppercase mb-2">この単語の意味は？</p>
    
    <%# 単語表示部分 %>
    <h2 id="question-text" class="text-5xl font-extrabold text-slate-800 mb-10">
      <%= @correct_word.original_text %>
    </h2>

    <div class="grid grid-cols-1 gap-4">
      <% @choices.each do |choice| %>
        <button onclick="checkAnswer(this, '<%= choice == @correct_word %>')" 
                class="choice-btn w-full py-4 px-6 text-lg font-semibold rounded-2xl border-2 border-slate-100 hover:border-indigo-500 hover:bg-indigo-50 transition-all duration-200 text-slate-700">
          <%= choice.meaning %>
        </button>
      <% end %>
    </div>
  </div>

  <%= link_to "一覧に戻る", root_path, class: "text-slate-400 text-sm" %>
</div>

<script>
  // ① 音声読み上げ関数
  function speak(text) {
    window.speechSynthesis.cancel();
    const uttr = new SpeechSynthesisUtterance();
    uttr.text = text;
    uttr.lang = 'en-US';
    uttr.rate = 0.9;
    window.speechSynthesis.speak(uttr);
  }

  // ページが読み込まれたら自動的に音声を再生
  document.addEventListener("turbo:load", function() {
    const questionText = document.getElementById("question-text");
    if (questionText) {
      // 画面表示から少しだけ遅らせて再生（ブラウザの自動再生ブロック対策）
      setTimeout(() => {
        speak(questionText.innerText.trim());
      }, 500);
    }
  }, { once: true });

  // ② 回答チェックと自動遷移
  function checkAnswer(button, isCorrect) {
    const buttons = document.querySelectorAll('.choice-btn');
    buttons.forEach(btn => btn.disabled = true);

    if (isCorrect === "true") {
      button.classList.add('bg-green-500', 'text-white', 'border-green-500');
      button.innerHTML += " ✨ Correct!";
    } else {
      button.classList.add('bg-red-500', 'text-white', 'border-red-500');
      button.innerHTML += " ❌ Wrong...";
      // 不正解のときは正解のボタンもハイライトすると親切です
    }
    
    // 1.5秒後に自動で次の問題へ
    setTimeout(() => {
      window.location.href = "<%= quiz_path %>";
    }, 1000);
  }
</script>