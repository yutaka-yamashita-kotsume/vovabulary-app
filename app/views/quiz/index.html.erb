<div class="max-w-2xl mx-auto px-4 py-12 text-center">
  
  <div class="mb-6">
    <span class="px-4 py-2 bg-slate-100 text-slate-600 rounded-full text-sm font-bold">
      Question <%= @current_index %> / <%= @total_questions %>
    </span>
  </div>

  <div class="bg-white rounded-3xl p-10 shadow-xl border border-slate-100 mb-8">
    <p class="text-sm text-indigo-500 font-bold tracking-widest uppercase mb-2">ã“ã®å˜èªã®æ„å‘³ã¯ï¼Ÿ</p>
    
    <%# å˜èªè¡¨ç¤ºéƒ¨åˆ† %>
    <h2 id="question-text" class="text-5xl font-extrabold text-slate-800 mb-10">
      <%= @correct_word.original_text %>
    </h2>
<div class="flex justify-center gap-1 mb-6">
  <span class="text-xs text-slate-400 mr-2">Current Status:</span>
  <% @correct_word.consecutive_correct_count.times do %>
    <span class="text-xl">ğŸ”¥</span>
  <% end %>
  <% (3 - @correct_word.consecutive_correct_count).times do %>
    <span class="text-xl text-slate-200">â—‹</span>
  <% end %>
</div>

    <div class="grid grid-cols-1 gap-4">
      <% @choices.each do |choice| %>
        <button onclick="checkAnswer(this, '<%= choice == @correct_word %>')" 
                class="choice-btn w-full py-4 px-6 text-lg font-semibold rounded-2xl border-2 border-slate-100 hover:border-indigo-500 hover:bg-indigo-50 transition-all duration-200 text-slate-700">
          <%= choice.meaning %>
        </button>
      <% end %>
    </div>
  </div>

  <%= link_to "ä¸€è¦§ã«æˆ»ã‚‹", root_path, class: "text-slate-400 text-sm" %>
</div>

<script>
  // éŸ³å£°èª­ã¿ä¸Šã’é–¢æ•°
  function speak(text) {
    if (!text) return;
    window.speechSynthesis.cancel();
    const uttr = new SpeechSynthesisUtterance(text);
    uttr.lang = 'en-US';
    uttr.rate = 0.9;
    window.speechSynthesis.speak(uttr);
  }

  // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®è‡ªå‹•å†ç”Ÿ
  // Turboç’°å¢ƒã§ã¯ turbo:load ã‚’ä½¿ã„ã¾ã™
  document.addEventListener("turbo:load", function() {
    const questionText = document.getElementById("question-text");
    if (questionText) {
      setTimeout(() => speak(questionText.innerText.trim()), 500);
    }
  }, { once: true });

  // å›ç­”ãƒã‚§ãƒƒã‚¯é–¢æ•°ï¼ˆ1ã¤ã«ã¾ã¨ã‚ã¾ã—ãŸï¼‰
  async function checkAnswer(button, isCorrectStr) {
    const isCorrect = isCorrectStr === "true";
    const buttons = document.querySelectorAll('.choice-btn');
    buttons.forEach(btn => btn.disabled = true);

    // ã‚µãƒ¼ãƒãƒ¼ã«çµæœã‚’é€ä¿¡
    try {
      await fetch("/quiz/record_answer", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRF-Token": document.querySelector('meta[name="csrf-token"]').content
        },
        body: JSON.stringify({
          word_id: "<%= @correct_word.id %>",
          correct: isCorrect
        })
      });
    } catch (e) {
      console.error("è¨˜éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ", e);
    }

    // è¦‹ãŸç›®ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
    if (isCorrect) {
      button.style.backgroundColor = "#22c55e";
      button.style.color = "white";
      button.innerHTML += " âœ¨ Correct!";
    } else {
      button.style.backgroundColor = "#ef4444";
      button.style.color = "white";
      button.innerHTML += " âŒ Wrong...";
    }
    
    // æ¬¡ã®å•é¡Œã¸é·ç§»
    setTimeout(() => {
      // TurboãŒä½¿ãˆãªã„å ´åˆã‚’è€ƒæ…®ã—ã¦ã€ç¢ºå®Ÿãªæ–¹æ³•ã§é·ç§»
      if (typeof Turbo !== 'undefined') {
        Turbo.visit("<%= quiz_path %>", { action: "replace" });
      } else {
        window.location.href = "<%= quiz_path %>";
      }
    }, 1200);
  }
</script>